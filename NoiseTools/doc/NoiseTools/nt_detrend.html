<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of nt_detrend</title>
  <meta name="keywords" content="nt_detrend">
  <meta name="description" content="[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter,wsize) - robustly remove trend">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">NoiseTools</a> &gt; nt_detrend.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for NoiseTools&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>nt_detrend
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter,wsize) - robustly remove trend</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter,wsize) - robustly remove trend
 
  y: detrended data
  w: updated weights
  r: basis matrix used

  x: raw data
  order: order of polynomial or number of sin/cosine pairs
  w0: weights
  basis: 'polynomials' [default] or 'sinusoids', or user-provided matrix
  thresh: threshold for outliers [default: 3 sd]
  niter: number of iterations [default: 3]
  wsize: window size for local detrending [default: all]

 This NEW (circa Oct 2019) version of detrend allows detrending to be
 applied to smaller overlapping windows, which are then stitched together
 using overlap-add. This is not described in the paper.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="nt_demean.html" class="code" title="function [x,mn]=nt_demean(x,w)">nt_demean</a>	[y,mn]=nt_demean(x,w) - remove weighted mean over cols</li><li><a href="nt_detrend.html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend</a>	[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter,wsize) - robustly remove trend</li><li><a href="nt_detrend2.html" class="code" title="function [y,w,r]=nt_detrend2(x,varargin)">nt_detrend2</a>	[y,w,r]=nt_detrend2(x,varargin) - robustly remove trend,</li><li><a href="nt_greetings.html" class="code" title="function nt_greetings(reset)">nt_greetings</a>	nt_greetings - display message the first time the toolbox is used</li><li><a href="nt_imagescc.html" class="code" title="function nt_imagescc(C)">nt_imagescc</a>	nt_imagescc - plot image with symmetric scaling</li><li><a href="nt_read_data.html" class="code" title="function [p,data]=nt_read_data(fname,flag)">nt_read_data</a>	[p,data]=nt_read_data(fname,flag) - read data from file</li><li><a href="nt_regw.html" class="code" title="function [b,z]=nt_regw(y,x,w)">nt_regw</a>	[b,z]=nt_regw(y,x,w) - weighted regression</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="nt_deboing.html" class="code" title="function y=nt_deboing(x,events)">nt_deboing</a>	y=nt_deboing(x,events) - fit, remove ringing associated with events</li><li><a href="nt_detrend (original).html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend (original)</a>	[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter,wsize) - robustly remove trend</li><li><a href="nt_detrend.html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend</a>	[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter,wsize) - robustly remove trend</li><li><a href="nt_detrend2.html" class="code" title="function [y,w,r]=nt_detrend2(x,varargin)">nt_detrend2</a>	[y,w,r]=nt_detrend2(x,varargin) - robustly remove trend,</li><li><a href="nt_eyeblink.html" class="code" title="function [y,z,mask]=nt_eyeblink(x,eyechans,nremove,sr)">nt_eyeblink</a>	[y,z,mask]=nt_eyeblink(x,eyechans,nremove) - project out eyeblinks</li><li><a href="nt_inpaint.html" class="code" title="function [y,yy]=nt_inpaint(x,w)">nt_inpaint</a>	function y=nt_inpaint(x,w) - weighted interpolation based on correlation structure</li><li><a href="nt_outliers.html" class="code" title="function [w,y]=nt_outliers(x,w,thresh,niter)">nt_outliers</a>	[w,y]=nt_outliers(x,w,thresh,niter) - detect outliers based on weighted correlation structure</li><li><a href="nt_star2.html" class="code" title="function [x,w,ww]=nt_star2(x,thresh,closest,w)">nt_star2</a>	[y,w,ww]=nt_star2(x,thresh,closest,w) - sensor noise suppression</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [y,w,r]=nt_detrend_helper(x,order,w,basis,thresh,niter)</a></li><li><a href="#_sub2" class="code">function test_me</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)</a>
0002 <span class="comment">%[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter,wsize) - robustly remove trend</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  y: detrended data</span>
0005 <span class="comment">%  w: updated weights</span>
0006 <span class="comment">%  r: basis matrix used</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%  x: raw data</span>
0009 <span class="comment">%  order: order of polynomial or number of sin/cosine pairs</span>
0010 <span class="comment">%  w0: weights</span>
0011 <span class="comment">%  basis: 'polynomials' [default] or 'sinusoids', or user-provided matrix</span>
0012 <span class="comment">%  thresh: threshold for outliers [default: 3 sd]</span>
0013 <span class="comment">%  niter: number of iterations [default: 3]</span>
0014 <span class="comment">%  wsize: window size for local detrending [default: all]</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% This NEW (circa Oct 2019) version of detrend allows detrending to be</span>
0017 <span class="comment">% applied to smaller overlapping windows, which are then stitched together</span>
0018 <span class="comment">% using overlap-add. This is not described in the paper.</span>
0019 
0020 <a href="nt_greetings.html" class="code" title="function nt_greetings(reset)">nt_greetings</a>;
0021 
0022 <span class="comment">%% arguments</span>
0023 <span class="keyword">if</span> nargin&lt;2||isempty(order); error(<span class="string">'!'</span>); <span class="keyword">end</span>
0024 <span class="keyword">if</span> nargin&lt;3; w0=[]; <span class="keyword">end</span>
0025 <span class="keyword">if</span> nargin&lt;4||isempty(basis); basis=<span class="string">'polynomials'</span>; <span class="keyword">end</span>
0026 <span class="keyword">if</span> nargin&lt;5||isempty(thresh); thresh=3; <span class="keyword">end</span>
0027 <span class="keyword">if</span> nargin&lt;6||isempty(niter); niter=3; <span class="keyword">end</span>
0028 <span class="keyword">if</span> nargin&lt;7; wsize=[]; <span class="keyword">end</span>
0029 
0030 <span class="keyword">if</span> iscell(x)
0031     <span class="keyword">if</span> ~isempty(w0); error(<span class="string">'not implemented'</span>); <span class="keyword">end</span>
0032     y={}; w={}; r={};
0033     <span class="keyword">for</span> iTrial=1:numel(x);
0034         [y{iTrial},w{iTrial},r{iTrial}]=<a href="nt_detrend.html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend</a>(x{iTrial},order,w0,basis,thresh,niter,wsize);
0035     <span class="keyword">end</span>
0036     <span class="keyword">return</span>
0037 <span class="keyword">end</span>
0038 
0039 w=w0;
0040 <span class="keyword">if</span> ~isempty(w)
0041     w=w(:);
0042     <span class="keyword">if</span> numel(w)&lt;size(x,1)
0043         <span class="comment">% assume that w contains indices, set them to 1</span>
0044         idx=w;
0045         w=zeros(size(x,1),1);
0046         w(idx)=1;
0047     <span class="keyword">end</span>
0048 <span class="keyword">end</span>
0049 
0050 <span class="keyword">if</span> isempty(wsize) || ~wsize
0051     <span class="comment">% standard detrending (trend fit to entire data)</span>
0052     [y,w,r]=<a href="#_sub1" class="code" title="subfunction [y,w,r]=nt_detrend_helper(x,order,w,basis,thresh,niter)">nt_detrend_helper</a>(x,order,w,basis,thresh,niter);
0053 <span class="keyword">else</span>
0054     wsize=2*floor(wsize/2);
0055     
0056     <span class="comment">% do some sanity checks because many parameters</span>
0057     <span class="keyword">if</span> numel(order)&gt;1; error(<span class="string">'!'</span>); <span class="keyword">end</span>
0058     <span class="keyword">if</span> ~isempty(w) &amp;&amp; ~(size(w,1)==size(x,1)) ; disp(size(w)); error(<span class="string">'!'</span>); <span class="keyword">end</span>
0059     <span class="keyword">if</span> ~(isempty(basis) || isstring(basis) || ~(isnumeric(basis)&amp;&amp;size(basis,1)==size(x,1))); error(<span class="string">'!'</span>); <span class="keyword">end</span>
0060     <span class="keyword">if</span> thresh==0; error(<span class="string">'thresh=0 is not what you want...'</span>); <span class="keyword">end</span> <span class="comment">% common mistake</span>
0061     <span class="keyword">if</span> numel(thresh)&gt;1; error(<span class="string">'!'</span>); <span class="keyword">end</span>
0062     <span class="keyword">if</span> numel(niter)&gt;1; error(<span class="string">'!'</span>); <span class="keyword">end</span>
0063 
0064     dims=size(x); nchans=dims(2);
0065     x=x(:,:); <span class="comment">% concatenates dims &gt;= 2</span>
0066     w=w(:,:);
0067     <span class="keyword">if</span> isempty(w); w=ones(size(x)); <span class="keyword">end</span>
0068     <span class="keyword">if</span> size(w,2)==1; w=repmat(w,1,size(x,2)); <span class="keyword">end</span>
0069 
0070 
0071     <span class="comment">% (1) divide into windows, (2) detrend each, (3) stitch together, (4)</span>
0072     <span class="comment">% estimate w</span>
0073 
0074     <span class="keyword">for</span> iIter=1:niter
0075 
0076         y=zeros(size(x));
0077         trend=zeros(size(x));
0078         a=zeros(size(x,1),1);
0079 
0080     <span class="comment">%     figure(1); clf</span>
0081 
0082         offset=0;
0083         <span class="keyword">while</span> true
0084             start=offset+1;
0085             stop=min(size(x,1),offset+wsize);
0086 
0087             <span class="comment">% if not enough valid samples grow window:</span>
0088             MAXGROW=1000; <span class="comment">% to avoid endless calculation (necessary?)</span>
0089             counter=MAXGROW;
0090             <span class="keyword">while</span> any( sum(w(start:stop,:)) &lt; wsize )<span class="keyword">...</span><span class="comment"> % smaller than wsize?</span>
0091                     || any(mean(w(start:stop,:))  &lt; 1/4) <span class="comment">% window has less than quarter ones?</span>
0092                 <span class="keyword">if</span> counter &lt;= 0 ; <span class="keyword">break</span>; <span class="keyword">end</span> 
0093                 start=max(1,start-wsize/2);
0094                 stop=min(size(x,1),stop+wsize/2);
0095                 counter=counter-1;
0096             <span class="keyword">end</span>
0097             <span class="keyword">if</span> rem(stop-start+1,2)==1; stop=stop-1; <span class="keyword">end</span>
0098             wsize2=stop-start+1;
0099 
0100             <span class="comment">% detrend this window</span>
0101             NITER=1;
0102             <span class="keyword">if</span> ~sum(w(start:stop)); error(<span class="string">'!'</span>); <span class="keyword">end</span>
0103             yy=<a href="#_sub1" class="code" title="subfunction [y,w,r]=nt_detrend_helper(x,order,w,basis,thresh,niter)">nt_detrend_helper</a>(x(start:stop,:),order,w(start:stop,:),basis,thresh,NITER);
0104 
0105             <span class="comment">% triangular weighting</span>
0106             <span class="keyword">if</span> start==1
0107                 b=[ones(1,wsize2/2)*wsize2/2, wsize2/2:-1:1]';
0108             <span class="keyword">elseif</span> stop==size(x,1)
0109                 b=[1:wsize2/2, ones(1,wsize2/2)*wsize2/2]';
0110             <span class="keyword">else</span>
0111                 b=[1:wsize2/2, wsize2/2:-1:1]';
0112             <span class="keyword">end</span>
0113 
0114             <span class="comment">% overlap-add to output</span>
0115             y(start:stop,:)=y(start:stop,:)+bsxfun(@times,yy,b);
0116             trend(start:stop,:)=trend(start:stop,:)+bsxfun(@times,x(start:stop,:)-yy,b);
0117 
0118             a(start:stop,1)=a(start:stop)+b;
0119 
0120             offset=offset+wsize/2;
0121             <span class="keyword">if</span> offset&gt;size(x,1)-wsize/2; <span class="keyword">break</span>; <span class="keyword">end</span>
0122         <span class="keyword">end</span>
0123         
0124         <span class="keyword">if</span> stop&lt;size(x,1); y(<span class="keyword">end</span>,:)=y(end-1,:); a(<span class="keyword">end</span>,:)=a(end-1,:); <span class="keyword">end</span>; <span class="comment">% last sample can be missed</span>
0125         
0126         y=bsxfun(@times,y,1./a); y(find(isnan(y)))=0;
0127         trend=bsxfun(@times,trend,1./a);  trend(find(isnan(trend)))=0;
0128 
0129         <span class="comment">% find outliers</span>
0130         d=x-trend; 
0131 
0132 
0133         <span class="keyword">if</span> ~isempty(w); d=bsxfun(@times,d,w); <span class="keyword">end</span>
0134         ww=ones(size(x));
0135         ww(find(abs(d)&gt;thresh*repmat(std(d),size(x,1),1))) = 0;
0136         clear d
0137 
0138         <span class="comment">% update weights</span>
0139         <span class="keyword">if</span> isempty(w); 
0140             w=ww;
0141         <span class="keyword">else</span>
0142             w=min(w,ww);
0143         <span class="keyword">end</span>
0144         clear ww;
0145 
0146     <span class="keyword">end</span> <span class="comment">% for iIter...</span>
0147     
0148     w=[];r=[]; <span class="comment">% not informative</span>
0149     
0150 <span class="keyword">end</span> <span class="comment">% if isempty(wsize)...</span>
0151 
0152 <span class="keyword">if</span> ~nargout
0153     <span class="comment">% don't return, just plot</span>
0154     subplot 411; plot(x); title(<span class="string">'raw'</span>); xlim([1,size(x,1)])
0155     subplot 412; plot(y); title(<span class="string">'detrended'</span>); xlim([1,size(x,1)])
0156     subplot 413; plot(x-y); title(<span class="string">'trend'</span>); xlim([1,size(x,1)])
0157     subplot 414; <a href="nt_imagescc.html" class="code" title="function nt_imagescc(C)">nt_imagescc</a>(w'); title(<span class="string">'weight'</span>);
0158     clear y w r
0159 <span class="keyword">end</span>
0160 <span class="keyword">end</span>
0161 
0162 <span class="comment">%% Original version of detrend (no windows) is called by new version (windows)</span>
0163 <a name="_sub1" href="#_subfunctions" class="code">function [y,w,r]=nt_detrend_helper(x,order,w,basis,thresh,niter)</a>
0164 <span class="comment">%[y,w,r]=nt_detrend(x,order,w,basis,thresh,niter) - robustly remove trend</span>
0165 <span class="comment">%</span>
0166 <span class="comment">%  y: detrended data</span>
0167 <span class="comment">%  w: updated weights</span>
0168 <span class="comment">%  r: basis matrix used</span>
0169 <span class="comment">%</span>
0170 <span class="comment">%  x: raw data</span>
0171 <span class="comment">%  order: order of polynomial or number of sin/cosine pairs</span>
0172 <span class="comment">%  w: weights</span>
0173 <span class="comment">%  basis: 'polynomials' [default] or 'sinusoids', or user-provided matrix</span>
0174 <span class="comment">%  thresh: threshold for outliers [default: 3 sd]</span>
0175 <span class="comment">%  niter: number of iterations [default: 3]</span>
0176 <span class="comment">%</span>
0177 <span class="comment">% Noise tools</span>
0178 <span class="comment">% See nt_regw().</span>
0179 <span class="comment">%</span>
0180 <span class="comment">% The data are fit to the basis using weighted least squares. The weight is</span>
0181 <span class="comment">% updated by setting samples for which the residual is greater than 'thresh'</span>
0182 <span class="comment">% times its std to zero, and the fit is repeated at most 'niter'-1 times.</span>
0183 <span class="comment">%</span>
0184 <span class="comment">% The choice of order (and basis) determines what complexity of the trend</span>
0185 <span class="comment">% that can be removed.  It may be useful to first detrend with a low order</span>
0186 <span class="comment">% to avoid fitting outliers, and then increase the order.</span>
0187 <span class="comment">%</span>
0188 <span class="comment">% Examples:</span>
0189 <span class="comment">% Fit linear trend, ignoring samples &gt; 3*sd from it, and remove:</span>
0190 <span class="comment">%   y=nt_detrend(x,1);</span>
0191 <span class="comment">% Fit/remove polynomial order=5 with initial weighting w, threshold = 4*sd:</span>
0192 <span class="comment">%   y=nt_detrend(x,5,w,[],4);</span>
0193 <span class="comment">% Fit/remove linear then 3rd order polynomial:</span>
0194 <span class="comment">%   [y,w]=nt_detrend(x,1);</span>
0195 <span class="comment">%   [yy,ww]=nt_detrend(y,3);</span>
0196 <span class="comment">%</span>
0197 <a href="nt_greetings.html" class="code" title="function nt_greetings(reset)">nt_greetings</a>;
0198 
0199 <span class="comment">% arguments</span>
0200 <span class="keyword">if</span> nargin&lt;2; error(<span class="string">'!'</span>); <span class="keyword">end</span>
0201 <span class="keyword">if</span> nargin&lt;3; w=[]; <span class="keyword">end</span>
0202 <span class="keyword">if</span> nargin&lt;4||isempty(basis); basis=<span class="string">'polynomials'</span>; <span class="keyword">end</span>
0203 <span class="keyword">if</span> nargin&lt;5||isempty(thresh); thresh=3; <span class="keyword">end</span>
0204 <span class="keyword">if</span> nargin&lt;6||isempty(niter); niter=3; <span class="keyword">end</span>
0205 
0206 <span class="keyword">if</span> thresh==0; error(<span class="string">'thresh=0 is not what you want...'</span>); <span class="keyword">end</span> <span class="comment">% common mistake</span>
0207 
0208 dims=size(x);
0209 x=x(:,:); <span class="comment">% concatenates dims &gt;= 2</span>
0210 w=w(:,:);
0211 
0212 <span class="keyword">if</span> size(w,2)==1; w=repmat(w,1,size(x,2)); <span class="keyword">end</span>
0213 
0214 <span class="comment">%% regressors</span>
0215 <span class="keyword">if</span> isnumeric(basis)
0216     r=basis;
0217 <span class="keyword">else</span>
0218     <span class="keyword">switch</span> basis
0219         <span class="keyword">case</span> <span class="string">'polynomials'</span>
0220             r=zeros(size(x,1),numel(order));
0221             lin=linspace(-1,1,size(x,1));
0222             <span class="keyword">for</span> k=1:order
0223                 r(:,k)=lin.^k;
0224             <span class="keyword">end</span>
0225         <span class="keyword">case</span> <span class="string">'sinusoids'</span>
0226             r=zeros(size(x,1),numel(order)*2);
0227             lin=linspace(-1,1,size(x,1));
0228             <span class="keyword">for</span> k=1:order
0229                 r(:,2*k-1)=sin(2*pi*k*lin/2);
0230                 r(:,2*k)=cos(2*pi*k*lin/2);
0231             <span class="keyword">end</span>
0232         <span class="keyword">otherwise</span>
0233             error(<span class="string">'!'</span>);
0234     <span class="keyword">end</span>
0235 <span class="keyword">end</span>
0236 
0237 
0238 <span class="comment">% remove trends</span>
0239 <span class="comment">% The tricky bit is to ensure that weighted means are removed before</span>
0240 <span class="comment">% calculating the regression (see nt_regw).</span>
0241 
0242 <span class="keyword">for</span> iIter=1:niter
0243     
0244     <span class="comment">% weighted regression on basis</span>
0245     [~,y]=<a href="nt_regw.html" class="code" title="function [b,z]=nt_regw(y,x,w)">nt_regw</a>(x,r,w);
0246     
0247     <span class="comment">% find outliers</span>
0248     d=x-y; 
0249     <span class="keyword">if</span> ~isempty(w); d=bsxfun(@times,d,w); <span class="keyword">end</span>
0250     ww=ones(size(x));
0251     ww(find(abs(d)&gt;thresh*repmat(std(d),size(x,1),1))) = 0;
0252      
0253     <span class="comment">% update weights</span>
0254     <span class="keyword">if</span> isempty(w); 
0255         w=ww;
0256     <span class="keyword">else</span>
0257         w=min(w,ww);
0258     <span class="keyword">end</span>
0259     clear ww;    
0260 <span class="keyword">end</span>
0261 y=x-y;
0262 y=reshape(y,dims);
0263 w=reshape(w,dims);
0264 
0265 <span class="keyword">end</span>
0266 
0267 <span class="comment">%% test code</span>
0268 <a name="_sub2" href="#_subfunctions" class="code">function test_me</a>
0269 <span class="keyword">if</span> 0
0270     <span class="comment">% basic</span>
0271     x=(1:100)'; x=x+ randn(size(x));
0272     WSIZE=30;
0273     y=<a href="nt_detrend2.html" class="code" title="function [y,w,r]=nt_detrend2(x,varargin)">nt_detrend2</a>(x,1,[],[],[],[],WSIZE);
0274     figure(1); clf; plot([x,y]);
0275 <span class="keyword">end</span>
0276 <span class="keyword">if</span> 0
0277     <span class="comment">% basic</span>
0278     x=(1:100)'; x=x+ randn(size(x));
0279     x(40:50)=0;
0280     WSIZE=30;
0281     [yy,ww]=<a href="nt_detrend2.html" class="code" title="function [y,w,r]=nt_detrend2(x,varargin)">nt_detrend2</a>(x,1,[],[],2,[],WSIZE);
0282     [y,w]=<a href="nt_detrend.html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend</a>(x,1);
0283     figure(1); clf; subplot 211; 
0284     plot([x,y,yy]);
0285     subplot 212; plot([w,ww],<span class="string">'.-'</span>);
0286 <span class="keyword">end</span>
0287 <span class="keyword">if</span> 0
0288     <span class="comment">% detrend biased random walk</span>
0289     x=cumsum(randn(1000,1)+0.1);
0290     WSIZE=200;
0291     [y1,w1]=<a href="nt_detrend.html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend</a>(x,1,[]);
0292     [y2,w2]=<a href="nt_detrend.html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend</a>(x,1,[],[],[],[],WSIZE);
0293     figure(1); clf; 
0294     plot([x,y1,y2]); legend(<span class="string">'before'</span>, <span class="string">'global'</span>, <span class="string">'local'</span>);
0295 <span class="keyword">end</span>
0296 <span class="keyword">if</span> 0
0297     <span class="comment">% weights</span>
0298     x=linspace(0,100,1000)';
0299     x=x+3*randn(size(x));
0300     x(1:100,:)=100;
0301     w=ones(size(x)); w(1:100,:)=0;
0302     y=<a href="nt_detrend2.html" class="code" title="function [y,w,r]=nt_detrend2(x,varargin)">nt_detrend2</a>(x,3,[],[],[],[],WSIZE);
0303     yy=<a href="nt_detrend2.html" class="code" title="function [y,w,r]=nt_detrend2(x,varargin)">nt_detrend2</a>(x,3,w,[],[],[],WSIZE);
0304     figure(1); clf; plot([x,y,yy]); legend(<span class="string">'before'</span>, <span class="string">'unweighted'</span>,<span class="string">'weighted'</span>);
0305 <span class="keyword">end</span>
0306 <span class="keyword">if</span> 0
0307     [p,x]=<a href="nt_read_data.html" class="code" title="function [p,data]=nt_read_data(fname,flag)">nt_read_data</a>(<span class="string">'/users/adc/data/meg/theoldmanandthesea/eeg/mc/MC_aespa_speech_43.mat'</span>); x=x'; x=x(:,1:128); <span class="comment">%x=x(1:10000,:);</span>
0308     <span class="comment">%[p,x]=nt_read_data('/data/meg/arzounian/ADC_DA_140521_p20/ADC_DA_140521_p20_01_calib'); x=x'; x=x(1:10000,:);</span>
0309     
0310     x=<a href="nt_demean.html" class="code" title="function [x,mn]=nt_demean(x,w)">nt_demean</a>(x);
0311     figure(1);
0312     <a href="nt_detrend.html" class="code" title="function [y,w,r]=nt_detrend(x,order,w0,basis,thresh,niter,wsize)">nt_detrend</a>(x,3);
0313     figure(2);
0314     WSIZE=1000;
0315     <a href="nt_detrend2.html" class="code" title="function [y,w,r]=nt_detrend2(x,varargin)">nt_detrend2</a>(x(:,:),3,[],[],[],[],WSIZE);
0316 <span class="keyword">end</span>
0317 <span class="keyword">end</span>
0318 
0319</pre></div>
<hr><address>Generated on Sat 29-Apr-2023 17:15:46 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>